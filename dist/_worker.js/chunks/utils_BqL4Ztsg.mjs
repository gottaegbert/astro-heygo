globalThis.process??={},globalThis.process.env??={};import{a as appendForwardSlash,j as joinPaths}from"./internal_q0A1Q6b1.mjs";import{A as AstroError,M as MissingLocale,R as REROUTE_DIRECTIVE_HEADER,i as i18nNoLocaleFoundInPath}from"./astro/server_8e5-x8mo.mjs";function shouldAppendForwardSlash(e,a){switch(e){case"always":return!0;case"never":return!1;case"ignore":switch(a){case"directory":return!0;case"preserve":case"file":return!1}}}function requestHasLocale(e){return function(a){return pathHasLocale(a.url.pathname,e)}}function pathHasLocale(e,a){const o=e.split("/");for(const e of o)for(const o of a)if("string"==typeof o){if(normalizeTheLocale(e)===normalizeTheLocale(o))return!0}else if(e===o.path)return!0;return!1}function getLocaleRelativeUrl({locale:e,base:a,locales:o,trailingSlash:t,format:r,path:n,prependWith:l,normalizeLocale:s=!0,strategy:c="pathname-prefix-other-locales",defaultLocale:i}){const u=peekCodePathToUse(o,e);if(!u)throw new AstroError({...MissingLocale,message:MissingLocale.message(e)});const f=[a,l],p=s?normalizeTheLocale(u):u;let h;return("pathname-prefix-always"===c||"pathname-prefix-always-no-redirect"===c||"domains-prefix-always"===c||"domains-prefix-always-no-redirect"===c||e!==i)&&f.push(p),f.push(n),h=shouldAppendForwardSlash(t,r)?appendForwardSlash(joinPaths(...f)):joinPaths(...f),""===h?"/":h}function getPathByLocale(e,a){for(const o of a)if("string"==typeof o){if(o===e)return o}else for(const a of o.codes)if(a===e)return o.path;throw new AstroError(i18nNoLocaleFoundInPath)}function normalizeTheLocale(e){return e.replaceAll("_","-").toLowerCase()}function getAllCodes(e){const a=[];for(const o of e)"string"==typeof o?a.push(o):a.push(...o.codes);return a}function peekCodePathToUse(e,a){for(const o of e)if("string"==typeof o){if(o===a)return o}else for(const e of o.codes)if(e===a)return o.path}function redirectToDefaultLocale({trailingSlash:e,format:a,base:o,defaultLocale:t}){return function(r,n){return shouldAppendForwardSlash(e,a)?r.redirect(`${appendForwardSlash(joinPaths(o,t))}`,n):r.redirect(`${joinPaths(o,t)}`,n)}}function notFound({base:e,locales:a,fallback:o}){return function(t,r){if("no"===r?.headers.get(REROUTE_DIRECTIVE_HEADER)&&void 0===o)return r;const n=t.url;return n.pathname===e+"/"||n.pathname===e||pathHasLocale(n.pathname,a)?void 0:r?(r.headers.set(REROUTE_DIRECTIVE_HEADER,"no"),new Response(r.body,{status:404,headers:r.headers})):new Response(null,{status:404,headers:{[REROUTE_DIRECTIVE_HEADER]:"no"}})}}function redirectToFallback({fallback:e,locales:a,defaultLocale:o,strategy:t,base:r,fallbackType:n}){return async function(l,s){if(s.status>=300&&e){const s=e?Object.keys(e):[],c=l.url.pathname.split("/").find((e=>{for(const o of a)if("string"==typeof o){if(o===e)return!0}else if(o.path===e)return!0;return!1}));if(c&&s.includes(c)){const s=getPathByLocale(e[c],a);let i;return i=s===o&&"pathname-prefix-other-locales"===t?l.url.pathname.includes(`${r}`)?l.url.pathname.replace(`/${c}`,""):l.url.pathname.replace(`/${c}`,"/"):l.url.pathname.replace(`/${c}`,`/${s}`),"rewrite"===n?await l.rewrite(i+l.url.search):l.redirect(i+l.url.search)}}return s}}function parseLocale(e){if("*"===e)return[{locale:e,qualityValue:void 0}];const a=[],o=e.split(",").map((e=>e.trim()));for(const e of o){const o=e.split(";").map((e=>e.trim())),t=o[0],r=o[1];if(o)if(r&&r.startsWith("q=")){const e=Number.parseFloat(r.slice(2));Number.isNaN(e)||e>1?a.push({locale:t,qualityValue:void 0}):a.push({locale:t,qualityValue:e})}else a.push({locale:t,qualityValue:void 0})}return a}function sortAndFilterLocales(e,a){const o=getAllCodes(a).map(normalizeTheLocale);return e.filter((e=>"*"===e.locale||o.includes(normalizeTheLocale(e.locale)))).sort(((e,a)=>e.qualityValue&&a.qualityValue?Math.sign(a.qualityValue-e.qualityValue):0))}function computePreferredLocale(e,a){const o=e.headers.get("Accept-Language");let t;if(o){const e=sortAndFilterLocales(parseLocale(o),a).at(0);if(e&&"*"!==e.locale)for(const o of a)if("string"==typeof o){if(normalizeTheLocale(o)===normalizeTheLocale(e.locale)){t=o;break}}else for(const a of o.codes)if(normalizeTheLocale(a)===normalizeTheLocale(e.locale)){t=a;break}}return t}function computePreferredLocaleList(e,a){const o=e.headers.get("Accept-Language");let t=[];if(o){const e=sortAndFilterLocales(parseLocale(o),a);if(1===e.length&&"*"===e.at(0).locale)return getAllCodes(a);if(e.length>0)for(const o of e)for(const e of a)if("string"==typeof e)normalizeTheLocale(e)===normalizeTheLocale(o.locale)&&t.push(e);else for(const a of e.codes)a===o.locale&&t.push(a)}return t}function computeCurrentLocale(e,a,o){for(const o of e.split("/"))for(const e of a)if("string"==typeof e){if(!o.includes(e))continue;if(normalizeTheLocale(e)===normalizeTheLocale(o))return e}else{if(e.path===o)return e.codes.at(0);for(const a of e.codes)if(normalizeTheLocale(a)===normalizeTheLocale(o))return a}for(const e of a)if("string"==typeof e){if(e===o)return e}else if(e.path===o)return e.codes.at(0)}function toRoutingStrategy(e,a){let o;const t=!!a&&Object.keys(a).length>0;return o="manual"===e?"manual":t?"domains-prefix-other-locales":"pathname-prefix-other-locales",o}export{redirectToDefaultLocale as a,requestHasLocale as b,normalizeTheLocale as c,computeCurrentLocale as d,computePreferredLocale as e,computePreferredLocaleList as f,getLocaleRelativeUrl as g,notFound as n,redirectToFallback as r,shouldAppendForwardSlash as s,toRoutingStrategy as t};